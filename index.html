<!DOCTYPE html>
<html>
    <head>
        <title>d3.js data driven page</title>
        <script src="https://d3js.org/d3.v6.min.js"></script>
        <style>
            th {
                color: blue;
            }

            .name {
                color: red;
                border: solid black 1pt;
            }

            .name:hover {
                border-width: 2pt;
            }

            .date {
                color: green;
            }
            .date:hover
            {
                font-weight: bold;
            }
        </style>
    </head>

    <body>
        <p>
            This page is inspired by the 
            <a href="https://observablehq.com/@d3/bar-chart-race" target="_blank"><b>Bar Chart Race</b></a>
            <button onclick="colorP()">Click me</button>

            <div id="dateSelector"></div>
            <table></table>


        </p>

        <script>
            csv_url = false ? "category-brands.csv" : "https://raw.githubusercontent.com/bernardo-dauria/2021-02-10-example/main/category-brands.csv";
            cs = {
                    "date": "fecha",
                    "name": "nombre",
                    "category": "categoria",
                    "value": "valor"
                };
            d3.csv(csv_url,
            (d,i,c) => {
                if (i>10) return d
                if (i==0) {
                    d3.select("table")
                        .append("tr")
                        .selectAll("th")
                        .data(c).enter()
                        .append("th").text(e => cs[e])
                }
                d3.select("table")
                .append("tr")
                .selectAll("td")
                .data(c).enter()
                .append("td").text(e => d[e])
                .attr("class", e => e)
            }).then(tidying)

            var data;
            function tidying(d) {
                data = d;
                dates = Array.from(new Set(d.map(e => e.date)));
                dateSelector(dates);
            }

            function dateSelector(d) {
                d.sort((a,b) => d3.ascending(a.date, b.date));    
                htmlNode = d3.select("#dateSelector");
                htmlNode.append("label")
                .attr("for", "dates")
                .text("Choose a date: ");
                htmlNode.append("select")
                .attr("id", "dates")
                .selectAll("option")
                .data(d).enter()
                .append("option")
                .attr("value", e => e)
                .text(e => e.slice(0,4));
            }

            function colorP() {
                d3.selectAll("p").style("color", "red");
            }
        </script>
    </body>
</html>
